# 缓存原理与设计

> 作者: 潘深练
>
> 更新: 2022-04-21

## 1、缓存基本思想

### 1.1、缓存的使用场景

#### 1)、DB缓存，减轻DB服务器压力

A. 一般情况下数据存在数据库中，应用程序直接操作数据库，当访问量 **上万**，数据库压力增大，可以采取的方案有：

- 读写分离
- 分库分表

B. 当访问量达到 **10 万**、**百万**，需要引入:

- 缓存

将已经访问过的内容或数据存储起来，当再次访问时先找缓存，缓存命中返回数据；不命中再找数据库，并回填缓存。

![](http://redis.panshenlian.com/_media/image/02-cache/02-cache-001.png)

#### 2)、提高系统响应

问题：

- 数据库的数据是存在文件里，也就是硬盘，应用进程访问硬盘的数据库文件时，需要通过内存做交换（swap）。
- 在大量瞬间访问时（高并发） MySQL 单机会因为频繁 IO 而造成无法响应。
- MySQL 的 InnoDB 存储引擎是有行锁，影响性能。

解决方案：

- 将数据缓存在 Redis 中，也就是存在了内存中，内存天然支持高并发访问，并且 Redis 的单线程设计，可以瞬间处理大量请求。
- QPS 到达 11万/S 的读请求，以及 8万/S 的写请求。

#### 3)、做Session分离

问题：

传统的 session 是由 tomcat 自己进行维护和管理，当出现集群或分布式环境时，不同的 tomcat 管理各自的 session，如果各个 tomcat 之间通过网络和 IO 进行 session 复制进行访问状态同步，会极大的影响了系统的性能。

解决方案：

通过 redis 缓存来作为第三方状态存储中间件，不同的 tomcat 通过 redis 读写 session ，保证了访问一致性，提高了系统性能。 

![](http://redis.panshenlian.com/_media/image/02-cache/02-cache-002.png)

#### 4)、做分布式锁（Redis）

锁有很多种类，包括数据库锁、单应用进程内的多线程锁，以及不同网络节点上多个服务之间的分布式锁。

而 redis 可以作为分布式锁的一种实现方案，可以使用： 

- Redis 的 setNX 机制
- 基于 RedLock （红锁）算法的 Redisson

#### 5)、做乐观锁（Redis）

同步锁和数据库中的行锁、表锁都是悲观锁，悲观锁的性能是比较低的，响应性比较差，高性能、高响应（秒杀）采用乐观锁， Redis 可以实现乐观锁，通过使用 watch + incr 机制。

### 1.2、什么是缓存？

### 1.3、大型网站中缓存的使用 


## 2、常见缓存的分类

## 3、缓存的优势、代价

## 4、缓存的读写模式

## 5、缓存架构的设计思路

## 6、实际案例



